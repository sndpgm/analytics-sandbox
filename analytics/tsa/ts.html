
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>時系列データ — Analytics Study Blog</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css">
<link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../../_static/copybutton.css" rel="stylesheet" type="text/css">
<link href="../../_static/mystnb.css" rel="stylesheet" type="text/css">
<link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/graphviz.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/sphinx-codeautolink.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../../_static/togglebutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<script src="../../_static/design-tabs.js"></script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
<script async="async" src="../../_static/sphinx-thebe.js"></script>
<script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<link href="../../genindex.html" rel="index" title="Index">
<link href="../../search.html" rel="search" title="Search"/>
<link href="arma.html" rel="next" title="ARMAモデル系"/>
<link href="../regression/blm.html" rel="prev" title="ベイズ線形回帰モデル"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="../../_static/logo.png"/>
<h1 class="site-logo" id="site-title">Analytics Study Blog</h1>
</a>
</div><form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<ul class="nav bd-sidenav bd-sidenav__home-link">
<li class="toctree-l1">
<a class="reference internal" href="../../intro.html">
                    Welcome to my Analytics Sandbox
                </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  確率変数と確率分布
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../distribution/rvs.html">
   確率変数
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../distribution/dist.html">
   確率分布
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../distribution/mdist.html">
   多変量確率分布
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  回帰モデル
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../regression/blm.html">
   ベイズ線形回帰モデル
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  時系列モデル
 </span>
</p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active">
<a class="current reference internal" href="#">
   時系列データ
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="arma.html">
   ARMAモデル系
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="arima.html">
   ARIMAモデル系
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="ssm.html">
   状態空間モデル
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  補足
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1">
<a class="reference internal" href="../math/calculus.html">
   微分積分学
  </a>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../math/linear_algebra.html">
   線形代数学
  </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading">
<span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../api/sandbox/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
     sandbox
    </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox">
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/datamodel/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.datamodel
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox">
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/datamodel/base/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datamodel.base
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/datamodel/ts_datamodel/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datamodel.ts_datamodel
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/datamodel/ts_simulator/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datamodel.ts_simulator
        </span>
</code>
</a>
</li>
</ul>
</input></li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.datasets
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox">
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/air_passengers/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.air_passengers
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/air_passengers/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.air_passengers.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/blsallfood/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.blsallfood
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/blsallfood/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.blsallfood.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/hakusan/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.hakusan
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/hakusan/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.hakusan.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/maxtemp/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.maxtemp
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/maxtemp/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.maxtemp.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/mye1f/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.mye1f
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
<label for="toctree-checkbox-8">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/mye1f/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.mye1f.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/nikkei225/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.nikkei225
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
<label for="toctree-checkbox-9">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/nikkei225/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.nikkei225.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/rtf/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.rtf
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
<label for="toctree-checkbox-10">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/rtf/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.rtf.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/datasets/whard/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.whard
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
<label for="toctree-checkbox-11">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/datasets/whard/data/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.datasets.whard.data
          </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/datasets/utils/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.datasets.utils
        </span>
</code>
</a>
</li>
</ul>
</input></li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/graphics/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.graphics
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
<label for="toctree-checkbox-12">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/graphics/ts_grapher/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.graphics.ts_grapher
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/graphics/utils/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.graphics.utils
        </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/metrics/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.metrics
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
<label for="toctree-checkbox-13">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/metrics/score/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.metrics.score
        </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/tests/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.tests
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
<label for="toctree-checkbox-14">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../api/sandbox/tests/datasets/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.tests.datasets
        </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
<label for="toctree-checkbox-15">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../api/sandbox/tests/datasets/test_utils/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
           sandbox.tests.datasets.test_utils
          </span>
</code>
</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/tsa/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.tsa
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
<label for="toctree-checkbox-16">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/tsa/base/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.tsa.base
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/tsa/sarimax/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.tsa.sarimax
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/tsa/ssm/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.tsa.ssm
        </span>
</code>
</a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../api/sandbox/utils/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
       sandbox.utils
      </span>
</code>
</a>
<input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
<label for="toctree-checkbox-17">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/utils/tools/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.utils.tools
        </span>
</code>
</a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../api/sandbox/utils/validation/index.html">
<code class="xref py py-mod docutils literal notranslate">
<span class="pre">
         sandbox.utils.validation
        </span>
</code>
</a>
</li>
</ul>
</li>
</ul>
</input></li>
</ul>
</div>
</nav></div>
<div class="bd-sidebar__bottom">
<!-- To handle the deprecated key -->
<div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>
</div>
</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
<button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-rocket"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://mybinder.org/v2/gh/sndpgm/analytics-sandbox/main?urlpath=tree/docs/analytics/tsa/ts.ipynb" title="Launch on Binder">
<span class="headerbtn__icon-container">
<img src="../../_static/images/logo_binder.svg"/>
</span>
<span class="headerbtn__text-container">Binder</span>
</a>
</li>
</ul>
</div>
</div>
<button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="headerbtn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<div class="menu-dropdown menu-dropdown-repository-buttons">
<button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
<i class="fab fa-github"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/sndpgm/analytics-sandbox" title="Source repository">
<span class="headerbtn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="headerbtn__text-container">repository</span>
</a>
</li>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/sndpgm/analytics-sandbox/issues/new?title=Issue%20on%20page%20%2Fanalytics/tsa/ts.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
<span class="headerbtn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="headerbtn__text-container">open issue</span>
</a>
</li>
</ul>
</div>
</div>
<div class="menu-dropdown menu-dropdown-download-buttons">
<button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
<i class="fas fa-download"></i>
</button>
<div class="menu-dropdown__content">
<ul>
<li>
<a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/analytics/tsa/ts.ipynb" title="Download source file">
<span class="headerbtn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="headerbtn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
<span class="headerbtn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="headerbtn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
</div>
<label class="headerbtn headerbtn-page-toc" for="__page-toc">
<span class="headerbtn__icon-container">
<i class="fas fa-list"></i>
</span>
</label>
</div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
   1. 時系列データ
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#air-passengers">
     例 1.1 (air_passengers)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#hakusan">
     例 1.2 (hakusan)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#sunspots">
     例 1.3 (sunspots)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#maxtemp">
     例 1.4 (maxtemp)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#blsallfood">
     例 1.5 (blsallfood)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#whard">
     例 1.6 (whard)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#mye1f">
     例 1.7 (mye1f)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#nikkei225">
     例 1.8 (nikkei225)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#tsa-time-series-stationarity">
   2. 定常性
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
     定義 2.1 (弱定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
     定義 2.2 (強定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
     定義 2.3 (非定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     例 2.4 (ホワイトノイズ)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id8">
     例 2.5 (ランダムウォークの非定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#ar-1">
     例 2.5 (AR(1) の定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#adf">
     検定 2.6 (ADF検定)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id9">
   3. コレログラム
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id10">
     定義 3.1 (自己相関関数)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id11">
     定義 3.2 (偏自己相関関数)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id12">
     例 3.3 (コレログラム)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id13">
   4. 時系列モデリングと定常性
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id14">
   5. データの前処理による定常化
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id15">
     例 5.1 (対数変換)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#box-cox">
     例 5.2 (Box-Cox 変換)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#tsa-time-series-preprocess-difference">
     例 5.3 (階差)
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>時系列データ</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
   1. 時系列データ
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#air-passengers">
     例 1.1 (air_passengers)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#hakusan">
     例 1.2 (hakusan)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#sunspots">
     例 1.3 (sunspots)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#maxtemp">
     例 1.4 (maxtemp)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#blsallfood">
     例 1.5 (blsallfood)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#whard">
     例 1.6 (whard)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#mye1f">
     例 1.7 (mye1f)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#nikkei225">
     例 1.8 (nikkei225)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#tsa-time-series-stationarity">
   2. 定常性
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
     定義 2.1 (弱定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
     定義 2.2 (強定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
     定義 2.3 (非定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     例 2.4 (ホワイトノイズ)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id8">
     例 2.5 (ランダムウォークの非定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#ar-1">
     例 2.5 (AR(1) の定常性)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#adf">
     検定 2.6 (ADF検定)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id9">
   3. コレログラム
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id10">
     定義 3.1 (自己相関関数)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id11">
     定義 3.2 (偏自己相関関数)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id12">
     例 3.3 (コレログラム)
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id13">
   4. 時系列モデリングと定常性
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#id14">
   5. データの前処理による定常化
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id15">
     例 5.1 (対数変換)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#box-cox">
     例 5.2 (Box-Cox 変換)
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#tsa-time-series-preprocess-difference">
     例 5.3 (階差)
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>時系列データ<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<section id="id2">
<h2>1. 時系列データ<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>ここではテストデータを用いて時系列データを俯瞰する.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>以降では <code class="docutils literal notranslate"><span class="pre">sandbox.datasets</span></code> モジュールにあるデータから取ってくるため, 特にデータロードの部分は同じコードで実施するためには <code class="docutils literal notranslate"><span class="pre">analytics-sandbox</span></code> レポジトリを clone する必要がある. もし clone せずにコードを実施する場合, 適宜 <code class="docutils literal notranslate"><span class="pre">pandas.read_csv</span></code> で取得する必要がある. 場合によってはそのコードも付しているが, ない場合には適宜各必要あり.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># グラフ図示に必要なモジュール</span>
<span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot" title="matplotlib.pyplot"><span class="nn">matplotlib.pyplot</span></a> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://pandas.pydata.org/pandas-docs/stable/index.html#module-pandas" title="pandas"><span class="nn">pandas</span></a> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># 一部 statsmodels から取得</span>
<span class="kn">from</span> <span class="nn">statsmodels.datasets</span> <span class="kn">import</span> <span class="n">sunspots</span>

<span class="c1"># sandbox.datasets にテストデータが保存されている</span>
<span class="c1"># sandbox.datasets.{dataset_name}.{dataset_name}.csv に生データ csv が配置</span>
<span class="kn">from</span> <a class="sphinx-codeautolink-a" href="../../api/sandbox/index.html#module-sandbox" title="sandbox"><span class="nn">sandbox</span></a> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="../../api/sandbox/datasets/index.html#module-sandbox.datasets" title="sandbox.datasets"><span class="n">datasets</span></a>

<a class="sphinx-codeautolink-a" href="https://seaborn.pydata.org/generated/seaborn.set.html#seaborn.set" title="seaborn.set"><span class="n">sns</span><span class="o">.</span><span class="n">set</span></a><span class="p">()</span>
<a class="sphinx-codeautolink-a" href="https://matplotlib.org/stable/api/matplotlib_configuration_api.html#matplotlib.rc" title="matplotlib.rc"><span class="n">sns</span><span class="o">.</span><span class="n">mpl</span><span class="o">.</span><span class="n">rc</span></a><span class="p">(</span><span class="s2">"font"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1949年から1960年の国際線月別乗客数データ (1000人)</span>
<span class="n">psgr</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">air_passengers</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># 外洋を航行中の船舶の方向角速度 (yaw rate) を1秒ごとに記録した時系列</span>
<span class="n">hakusan</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">hakusan</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># 毎年の太陽黒点数 (wolfer sunspot number) を記録した時系列</span>
<span class="n">sunspot</span> <span class="o">=</span> <span class="n">sunspots</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
<span class="n">sunspot</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">sunspot</span><span class="o">.</span><span class="n">YEAR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#int" title="int"><span class="nb">int</span></a><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sunspot</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"YEAR"</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 東京の毎日の最高気温を16ヶ月にわたって記録したデータ</span>
<span class="n">maxtemp</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">maxtemp</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># アメリカの食品産業に従事する労働者の人数を毎月調べた時系列</span>
<span class="n">blsallfood</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">blsallfood</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># あるハードウェアの毎月の卸売高を記録したデータ</span>
<span class="n">whard</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">whard</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># 地震波の東西成分を約0.02秒間隔で記録した時系列</span>
<span class="n">mye1f</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">mye1f</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># 日経225平均株価データで1988/1/4から1993/12/30までの日次終値を示す</span>
<span class="n">nikkei225</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">nikkei225</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<section id="air-passengers">
<h3>例 1.1 (air_passengers)<a class="headerlink" href="#air-passengers" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>トレンド (上昇トレンド)</p></li>
<li><p>トレンド周りは周期的な変化あり</p></li>
<li><p>平均非定常, 共分散非定常</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">psgr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(a) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">air_passengers</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_5_0.png" src="../../_images/ts_5_0.png">
</img></div>
</div>
</section>
<section id="hakusan">
<h3>例 1.2 (hakusan)<a class="headerlink" href="#hakusan" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>定常性</p>
<ul>
<li><p>0 の付近で波形が前後</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">hakusan</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">"YawRate"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(b) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">hakusan</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_7_0.png" src="../../_images/ts_7_0.png">
</img></div>
</div>
</section>
<section id="sunspots">
<h3>例 1.3 (sunspots)<a class="headerlink" href="#sunspots" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>正値のみを取り, 上下非対称</p></li>
<li><p>約10年周期で同様なパターンをとる (疑似周期性)</p></li>
<li><p>前後非対称</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sunspot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(c) </span><span class="si">{</span><span class="n">sunspots</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_9_0.png" src="../../_images/ts_9_0.png"/>
</div>
</div>
</section>
<section id="maxtemp">
<h3>例 1.4 (maxtemp)<a class="headerlink" href="#maxtemp" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>トレンドとして年周期あり</p></li>
<li><p>トレンドの周りはほぼ定常と見られる</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">maxtemp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(d) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">maxtemp</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_11_0.png" src="../../_images/ts_11_0.png"/>
</div>
</div>
</section>
<section id="blsallfood">
<h3>例 1.5 (blsallfood)<a class="headerlink" href="#blsallfood" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>年周期あり</p></li>
<li><p>1975年に向けて減少トレンド, それ以降は増加トレンド</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">blsallfood</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(e) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">blsallfood</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_13_0.png" src="../../_images/ts_13_0.png"/>
</div>
</div>
</section>
<section id="whard">
<h3>例 1.6 (whard)<a class="headerlink" href="#whard" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>年周期</p></li>
<li><p>ほぼ同じ割合で増加するトレンドが見られ, それに連動して変動も徐々に増加</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">whard</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(f) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">whard</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_15_0.png" src="../../_images/ts_15_0.png"/>
</div>
</div>
</section>
<section id="mye1f">
<h3>例 1.7 (mye1f)<a class="headerlink" href="#mye1f" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>トレンドなし</p></li>
<li><p>P波の区間, S波の区間, 地震の終了していく区間で定常 (区分的定常性)</p></li>
<li><p>分散非定常, 共分散非定常</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">mye1f</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(g) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">mye1f</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_17_0.png" src="../../_images/ts_17_0.png"/>
</div>
</div>
</section>
<section id="nikkei225">
<h3>例 1.8 (nikkei225)<a class="headerlink" href="#nikkei225" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>非定常性</p>
<ul>
<li><p>トレンド + 分散変動</p></li>
<li><p>トレンド下降時にブレが大きい (分散の増加)</p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">nikkei225</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"(h) </span><span class="si">{</span><span class="n">datasets</span><span class="o">.</span><span class="n">nikkei225</span><span class="o">.</span><span class="n">TITLE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_19_0.png" src="../../_images/ts_19_0.png"/>
</div>
</div>
</section>
</section>
<section id="tsa-time-series-stationarity">
<span id="id3"></span><h2>2. 定常性<a class="headerlink" href="#tsa-time-series-stationarity" title="Permalink to this headline">#</a></h2>
<p>時系列 <span class="math notranslate nohighlight">\(y_1, \dots, y_n\)</span> について, 平均と分散を</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        &amp;\text{(平均)} \quad \mu_t = {\rm E}(y_t)\\
        &amp;\text{(分散)} \quad \sigma_t^2 = {\rm E}[(y_t - \mu_t)^2]
    \end{align}
\end{split}\]</div>
<p>とおく. ただし <span class="math notranslate nohighlight">\(t = 1, \dots, n\)</span> とする. また, 同一時系列内の共分散を</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        {\rm Cov}(y_s, y_t) = {\rm E}[(y_s - \mu_s)(y_t - \mu_t)], \quad s = 1, \dots, n,　t = 1, \dots, n
    \end{align}
\]</div>
<p>と表し, これを<strong>自己共分散</strong> (autocovariance) と呼ぶ. これらを用いて定常性について定義する.</p>
<section id="id4">
<h3>定義 2.1 (弱定常性)<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p>時系列 <span class="math notranslate nohighlight">\(y_1, \dots, y_n\)</span> の平均, 分散, 自己共分散が時間を通じて変化しないとき<strong>弱定常性</strong> (weakly stationary) であるという. すなわち任意の整数 <span class="math notranslate nohighlight">\(k\)</span> について</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        &amp;\mu_{t+k} = \mu_t \\
        &amp;\sigma_{t+k}^2 = \sigma_t^2 \\
        &amp;{\rm Cov}(y_{s+k}, y_{t+k}) = {\rm Cov}(y_s, y_t)
    \end{align}
\end{split}\]</div>
<p>を満たす.</p>
</div></section>
<section id="id5">
<h3>定義 2.2 (強定常性)<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p>時系列 <span class="math notranslate nohighlight">\(y_1, \dots, y_n\)</span> の分布が時間を通じて不変で, その確率分布を時間軸方向に移動しても変化しないとき<strong>強定常性</strong> (strongly stationary) であるという. すなわち同時密度関数 <span class="math notranslate nohighlight">\(f\)</span> について任意の時点の集合 <span class="math notranslate nohighlight">\(\{ t_1, \dots, t_m \}\)</span> と任意の整数 <span class="math notranslate nohighlight">\(k\)</span> に対して</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        f(y_{t_1 + k}, \dots, y_{t_m + k}) = f(y_{t_1}, \dots, y_{t_m})
    \end{align}
\]</div>
<p>を満たす.</p>
</div></section>
<section id="id6">
<h3>定義 2.3 (非定常性)<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p>常に定常性を満たさない時系列は<strong>非定常</strong> (non-stationary) であるという.</p>
</div></section>
<section id="id7">
<h3>例 2.4 (ホワイトノイズ)<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h3>
<p>定常な時系列の最も簡単な例として<strong>ホワイトノイズ</strong> (white noise) が挙げられる. 時系列 <span class="math notranslate nohighlight">\(\eta_1, \dots, \eta_n\)</span> がホワイトノイズのとき,</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        {\rm Cov}(\eta_s, \eta_t) = 0 \quad (s \neq t)
    \end{align}
\]</div>
<p>を示す. 時系列 <span class="math notranslate nohighlight">\(\{ \varepsilon_t \}\)</span> が正規分布 <span class="math notranslate nohighlight">\(N(\mu, \sigma^2)\)</span> に従うホワイトノイズの時 <span class="math notranslate nohighlight">\(\varepsilon_t \sim \text{WN}(\mu, \sigma^2)\)</span> と書く.<br/>
　ここでは時系列 <span class="math notranslate nohighlight">\(\eta_1, \dots, \eta_n\)</span> が互いに独立した正規分布 <span class="math notranslate nohighlight">\(N(0, 1)\)</span> に従うホワイトノイズを考えてみる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="numpy"><span class="nn">numpy</span></a> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># 標準正規分布を1000だけ生起</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">rng</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://numpy.org/doc/stable/reference/random/generator.html#numpy.random.default_rng" title="numpy.random.default_rng"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span></a><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">wn</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="n">df_wn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">wn</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"white_noise"</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df_wn</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"White Noise"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_25_0.png" src="../../_images/ts_25_0.png"/>
</div>
</div>
</section>
<section id="id8">
<h3>例 2.5 (ランダムウォークの非定常性)<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h3>
<p>時系列 <span class="math notranslate nohighlight">\(y_1, \dots, y_n\)</span> が<strong>ランダムウォーク</strong> (random walk) を構成するとき, 互いに独立な標準正規分布をとるホワイトノイズ <span class="math notranslate nohighlight">\(\eta_t\)</span> を用いて</p>
<div class="math notranslate nohighlight">
\[
    y_t = y_{t-1} + \eta_t, \quad t = 1, \dots, n, \quad \{\eta_t\} \sim \text{i.i.d} \ N(0, \sigma_{\eta}^2)
\]</div>
<p>と表せられる.<br/>
　ランダムウォーク <span class="math notranslate nohighlight">\(\{ y_t \}\)</span> は <span class="math notranslate nohighlight">\(\nabla y_t = y_t - y_{t-1} = \eta_t\)</span> と変形したときに, 時系列 <span class="math notranslate nohighlight">\(\{ \nabla y_t \}\)</span> はホワイトノイズとなり定常となる. このように一階の階差を取ることで定常過程となる時系列を <strong>一次の和分過程</strong> (integrated process of order one) に従っているといい, <span class="math notranslate nohighlight">\(I(1)\)</span> 過程と表現される. <span class="math notranslate nohighlight">\(I(0)\)</span> は定常過程として表現される.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># 先ほど生成したホワイトノイズを利用</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">df_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"random_walk"</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df_y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Random Walk"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_27_0.png" src="../../_images/ts_27_0.png"/>
</div>
</div>
<p>ランダムウォークは以下のように書ける.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        y_{t} &amp;= y_{t-1} + \eta_{t} \\
              &amp;= y_{t-2} + \eta_{t-1} + \eta_{t} \\
              &amp;\cdots \\
              &amp;= y_{0} + \eta_{1} + \cdots + \eta_{t}
    \end{align}
\end{split}\]</div>
<p>ゆえに期待値, 分散をとると</p>
<div class="math notranslate nohighlight">
\[
    {\rm E}(y_{t}) = y_{0}, \quad {\rm Var}(y_{t}) = t \sigma_{\eta}^{2}
\]</div>
<p>となり, <span class="math notranslate nohighlight">\({\rm E}(y_{t}) = {\rm E}(y_{t+k})\)</span> であるが, <span class="math notranslate nohighlight">\({\rm Var}(y_{t}) \neq {\rm Var}(y_{t+k})\)</span>.
　また, <span class="math notranslate nohighlight">\(s &lt; t\)</span> とすれば</p>
<div class="math notranslate nohighlight">
\[
    y_{t} = y_{s} + \eta_{s+1} + \eta_{s+2} + \cdots + \eta_{t}
\]</div>
<p>と書けるので,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        {\rm Cov}(y_s, y_t) &amp;= {\rm E} \bigl((y_s - y_0)(y_t - y_0) \bigr) \\
                            &amp;= {\rm E} \bigl((y_s - y_0)(y_{s} + \eta_{s+1} + \eta_{s+2} + \cdots + \eta_{t} - y_0) \bigr) \\
                            &amp;= {\rm E} \bigl((y_s - y_0)^2 + (y_s - y_0)(\eta_{s+1} + \eta_{s+2} + \cdots + \eta_{t}) \bigr) \\
                            &amp;= {\rm E} \bigl((y_s - y_0)^2 \bigr) + {\rm E} \bigl( (y_s - y_0)(\eta_{s+1} + \eta_{s+2} + \cdots + \eta_{t}) \bigr) \\
                            &amp;= {\rm E} \bigl((y_s - y_0)^2 \bigr) \\
                            &amp;= {\rm Var} (y_s) \\
                            &amp;= s \sigma_{\eta}^{2}
    \end{align}
\end{split}\]</div>
<p>ゆえに, <span class="math notranslate nohighlight">\({\rm Cov}(y_{s+k}, y_{t+k}) = (s+k) \sigma_{\eta}^{2}\)</span> より <span class="math notranslate nohighlight">\({\rm Cov}(y_{s+k}, y_{t+k}) \neq {\rm Cov}(y_{s}, y_{t})\)</span> で弱定常性条件を満たさない.<br/>
　また, <span class="math notranslate nohighlight">\(y_1, \dots, y_t\)</span> の同時確率密度関数 <span class="math notranslate nohighlight">\(f(y_1, \dots, y_t)\)</span> は</p>
<div class="math notranslate nohighlight">
\[
    f(y_1, \dots, y_t) \propto \prod_{i=1}^{t} { \frac{1}{\sqrt{2 \pi i \sigma_{\eta}^{2}} } \exp{ \biggl(  - \frac{(y_i - y_0)^2}{2 i \sigma_{\eta}^{2}} \biggr) } }
\]</div>
<p>より明らかに <span class="math notranslate nohighlight">\(f(y_{t_1 + k}, \dots, y_{t_m + k}) \neq f(y_{t_1}, \dots, y_{t_m})\)</span> であるので強定常性条件も満たさないので, 非定常性である.</p>
</section>
<section id="ar-1">
<h3>例 2.5 (AR(1) の定常性)<a class="headerlink" href="#ar-1" title="Permalink to this headline">#</a></h3>
<p>1次の自己回帰過程 (AR(1)) に従う時系列 <span class="math notranslate nohighlight">\(\{ y_t \}\)</span> は以下のように書ける.</p>
<div class="math notranslate nohighlight">
\[
    y_t = m + \phi y_{t-1} + \eta_t, \quad t = 1, \dots, n, \quad \{\eta_t\} \sim \text{i.i.d} \ N(0, \sigma_{\eta}^2)
\]</div>
<p>ここで期待値を計算してみる.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        {\rm E}(y_t) &amp;= {\rm E}(m + \phi y_{t-1} + \eta_t) \\
                     &amp;= m + \phi {\rm E}(y_{t-1})
    \end{align}
\end{split}\]</div>
<p>AR(1) が定常性をもつものとすれば, <span class="math notranslate nohighlight">\(E(y_t) = E(y_{t-1})\)</span> より <span class="math notranslate nohighlight">\(\mu\)</span> とすれば <span class="math notranslate nohighlight">\(\phi \neq 1\)</span> とし</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        \mu = m + \phi \mu \Leftrightarrow \mu = \frac{m}{1-\phi}
    \end{align}
\]</div>
<p>また分散 <span class="math notranslate nohighlight">\(\sigma^2\)</span> も同様にして</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        \sigma^2 = \phi^2 \sigma^2 + \sigma_{\eta}^2 \Leftrightarrow \sigma^2 = \frac{\sigma_{\eta}^2}{1-\phi^2}
    \end{align}
\]</div>
<p><span class="math notranslate nohighlight">\(\sigma^2 &gt; 0\)</span> より定常性を備えるためには <span class="math notranslate nohighlight">\(1-\phi^2 &gt; 0 \Leftrightarrow |\phi| &lt; 1\)</span> が必要.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="n">ar1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># 先ほど生成したホワイトノイズを利用</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">ar1</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">ar1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">df_ar1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ar1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"AR(1)"</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df_ar1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"AR(1)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_30_0.png" src="../../_images/ts_30_0.png"/>
</div>
</div>
<p>また <span class="math notranslate nohighlight">\(|\phi| &gt; 1\)</span> の時は時系列が発散してしまう.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ar1_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
<span class="n">ar1_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mf">1.1</span>

<span class="c1"># 先ほど生成したホワイトノイズを利用</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#range" title="range"><span class="nb">range</span></a><span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">ar1_</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">ar1_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">wn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">df_ar1_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ar1_</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"AR(1)"</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df_ar1_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"AR(1) (Divergence)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_32_0.png" src="../../_images/ts_32_0.png"/>
</div>
</div>
</section>
<section id="adf">
<h3>検定 2.6 (ADF検定)<a class="headerlink" href="#adf" title="Permalink to this headline">#</a></h3>
<p><strong>ADF検定 (拡張ディッキー・フラー検定)</strong> (augumented Dickey-Fuller test) は与えられた時系列 <span class="math notranslate nohighlight">\(\{ y_t \}\)</span> についての以下の仮設検定を行う.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        &amp;\text{帰無仮説} \ H_0: y_t \sim I(1) \\
        &amp;\text{対立仮設} \ H_1: y_t \sim I(0)
    \end{align}
\end{split}\]</div>
<p>ゆえに簡易的に定常性を確認できるが, 仮に帰無仮説が棄却できなかったとしても, <span class="math notranslate nohighlight">\(\nabla^2 y_t = (y_t - y_{t-1}) - (y_{t-1} - y_{t-2})\)</span> が <span class="math notranslate nohighlight">\(I(0)\)</span> に従う, すなわち <span class="math notranslate nohighlight">\(y_t \sim I(2)\)</span> の可能性があるので, 棄却できなかった場合には階差をとったデータで検定を行うことも検討するとよい.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.stattools.adfuller.html#statsmodels.tsa.stattools.adfuller" title="statsmodels.tsa.stattools.adfuller"><span class="n">adfuller</span></a>

<span class="n">ret_</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.tsa.stattools.adfuller.html#statsmodels.tsa.stattools.adfuller" title="statsmodels.tsa.stattools.adfuller"><span class="n">adfuller</span></a><span class="p">(</span><span class="n">hakusan</span><span class="p">[</span><span class="s2">"YawRate"</span><span class="p">])</span>

<span class="n">ret_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"adfstat"</span><span class="p">,</span> <span class="s2">"pvalue"</span><span class="p">,</span> <span class="s2">"usedlag"</span><span class="p">,</span> <span class="s2">"nobs"</span><span class="p">,</span> <span class="s2">"critvalues"</span><span class="p">,</span> <span class="s2">"icbest"</span><span class="p">]</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ret</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#dict" title="dict"><span class="nb">dict</span></a><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ret_keys</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{'adfstat': -6.1193416637984015,
 'pvalue': 8.933551221207623e-08,
 'usedlag': 16,
 'nobs': 983,
 'critvalues': {'1%': -3.4370198458812156,
  '5%': -2.864484708707697,
  '10%': -2.568337912084273},
 'icbest': 2119.0840225668217}
</pre></div>
</div>
</div>
</div>
<p>上記の結果から <code class="docutils literal notranslate"><span class="pre">hakusan["YawRate"]</span></code><span class="math notranslate nohighlight">\(\sim I(0)\)</span> と見なしても問題ない.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">adfstat</span></code> : 検定統計量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pvalue</span></code> : <span class="math notranslate nohighlight">\(p\)</span> 値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usedlag</span></code> : ADF検定で前提としている <span class="math notranslate nohighlight">\(\text{AR}(p)\)</span> 過程における <span class="math notranslate nohighlight">\(p\)</span> の値 (情報基準で最適な値を採用)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nobs</span></code> : ADF検定で使用した観測値の数</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">critvalues</span></code> : <span class="math notranslate nohighlight">\(p\)</span> 値1%, 5%, 10%それぞれに対する統計臨界値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">icbest</span></code> : 情報基準の値</p></li>
</ul>
<p>一方で <code class="docutils literal notranslate"><span class="pre">nikkei225</span></code> はADF検定により <span class="math notranslate nohighlight">\(I(0)\)</span> 過程でないことが分かる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">nikkei225</span><span class="p">)</span>

<span class="n">ret_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"adfstat"</span><span class="p">,</span> <span class="s2">"pvalue"</span><span class="p">,</span> <span class="s2">"usedlag"</span><span class="p">,</span> <span class="s2">"nobs"</span><span class="p">,</span> <span class="s2">"critvalues"</span><span class="p">,</span> <span class="s2">"icbest"</span><span class="p">]</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ret</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#dict" title="dict"><span class="nb">dict</span></a><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ret_keys</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{'adfstat': -0.8863644520571672,
 'pvalue': 0.7924296279527006,
 'usedlag': 10,
 'nobs': 1469,
 'critvalues': {'1%': -3.4348093353507494,
  '5%': -2.863509503599295,
  '10%': -2.5678185447142},
 'icbest': 20958.594912460438}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nikkei225</span></code> に対して階差をとったデータに対してもう一度ADF検定を取ると帰無仮説が棄却され, グラフ化すると定常的な推移を示す.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nikkei225_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">nikkei225</span><span class="p">[</span><span class="s2">"nikkei225"</span><span class="p">]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"diff_nikkei225"</span><span class="p">])</span>

<span class="n">ret_</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">nikkei225_</span><span class="p">)</span>
<span class="n">ret_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"adfstat"</span><span class="p">,</span> <span class="s2">"pvalue"</span><span class="p">,</span> <span class="s2">"usedlag"</span><span class="p">,</span> <span class="s2">"nobs"</span><span class="p">,</span> <span class="s2">"critvalues"</span><span class="p">,</span> <span class="s2">"icbest"</span><span class="p">]</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ret</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#dict" title="dict"><span class="nb">dict</span></a><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ret_keys</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{'adfstat': -10.217930348147535,
 'pvalue': 5.419565541031902e-18,
 'usedlag': 9,
 'nobs': 1469,
 'critvalues': {'1%': -3.4348093353507494,
  '5%': -2.863509503599295,
  '10%': -2.5678185447142},
 'icbest': 20943.788988444103}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">nikkei225_</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_40_0.png" src="../../_images/ts_40_0.png"/>
</div>
</div>
</section>
</section>
<section id="id9">
<h2>3. コレログラム<a class="headerlink" href="#id9" title="Permalink to this headline">#</a></h2>
<p>以降では時系列 <span class="math notranslate nohighlight">\(\{ y_n \}\)</span> に定常性を仮定すると平均と, 自己共分散は以下のように書ける.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \text{(平均)} \quad &amp;\mu = {\rm E}(y_n) \\
        \text{(自己共分散)} \quad &amp;C_k = {\rm Cov}(y_n, y_{n-k}) = {\rm E}\bigl[ (y_n - \mu)(y_{n-k} - \mu) \bigr]
    \end{align}
\end{split}\]</div>
<p>コレログラムを作成するのに必要な自己相関関数, 偏自己相関関数を定義する上では上記を前提に進める.</p>
<section id="id10">
<h3>定義 3.1 (自己相関関数)<a class="headerlink" href="#id10" title="Permalink to this headline">#</a></h3>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p>定常時系列における<strong>自己相関関数</strong> (autocorrelation function, ACF) は以下で定義される.</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        \rho_k = \frac{{\rm Cov}(y_n, y_{n-k})}{\sqrt{{\rm Var}(y_n){\rm Var}(y_{n-k})}} = \frac{C_k}{C_0}
    \end{align}
\]</div>
</div>
<p>時系列データ <span class="math notranslate nohighlight">\(\{ y_1, \cdots, y_N \}\)</span> が与えられたとき, 平均 <span class="math notranslate nohighlight">\(\mu\)</span>, 自己共分散 <span class="math notranslate nohighlight">\(C_k\)</span> および自己相関関数 <span class="math notranslate nohighlight">\(\rho_k\)</span> の推定値 <span class="math notranslate nohighlight">\(\hat{\mu}_k, \hat{C}_k, \hat{\rho}_k\)</span> は次の式で求められる.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        &amp; \hat{\mu}_k = \frac{1}{N} \sum_{n=1}^{N}{y_n}                                        \\
        &amp; \hat{C}_k = \frac{1}{N} \sum_{n=k+1}^{N}{(y_n - \hat{\mu}_k)(y_{n-k} - \hat{\mu}_k)} \\
        &amp; \hat{\rho}_k = \frac{\hat{C}_k}{\hat{C}_0}
    \end{align}
\end{split}\]</div>
<p>それぞれ<strong>標本平均</strong>(sample mean), <strong>標本自己共分散</strong> (sample autocovariance), <strong>標本自己相関関数</strong> (sample autocorrelation function) と言う.</p>
</section>
<section id="id11">
<h3>定義 3.2 (偏自己相関関数)<a class="headerlink" href="#id11" title="Permalink to this headline">#</a></h3>
<p>自己相関関数において他の時系列の影響までは勘案できていない. すなわち, <span class="math notranslate nohighlight">\(y_n, y_{n-k}\)</span> の自己相関の中には時点 <span class="math notranslate nohighlight">\(n-1, n-2, \cdots, n-k+1\)</span> の影響を含みうる. ここで以下の等式が成立するものとする.</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        y_t - \mu = \phi_{k,1} (y_{t-1} - \mu) + \phi_{k,2} (y_{t-2} - \mu) + \cdots + \phi_{k,k} (y_{t-k} - \mu)
    \end{align}
\]</div>
<p>この等式に対して <span class="math notranslate nohighlight">\((y_{t-i} - \mu) \quad (i = 1, \dots, k)\)</span> を両辺に掛け期待値を取ると</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        &amp; (y_t - \mu)(y_{t-i} - \mu) = \phi_{k,1} (y_{t-1} - \mu)(y_{t-i} - \mu) + \phi_{k,2} (y_{t-2} - \mu)(y_{t-i} - \mu) + \cdots + \phi_{k,k} (y_{t-k} - \mu)(y_{t-i} - \mu) \\
        \Leftrightarrow \ &amp; {\rm E}(y_t - \mu)(y_{t-i} - \mu) = \phi_{k,1} {\rm E}(y_{t-1} - \mu)(y_{t-i} - \mu) + \phi_{k,2} {\rm E}(y_{t-2} - \mu)(y_{t-i} - \mu) + \cdots + \phi_{k,k} {\rm E}(y_{t-k} - \mu)(y_{t-i} - \mu) \\
        \Leftrightarrow \ &amp;  C_i = \phi_{k,1} C_{i-1} + \phi_{k,2} C_{i-2} + \cdots + \phi_{k,k} C_{k-i} \quad (i = 1, \cdots, k)
    \end{align}
\end{split}\]</div>
<p>両辺を <span class="math notranslate nohighlight">\(C_0\)</span> で割ると</p>
<div class="math notranslate nohighlight">
\[
    \begin{align}
        \rho_i = \phi_{k,1} \rho_{i-1} + \phi_{k,2} \rho_{i-2} + \cdots + \phi_{k,k} \rho_{k-i} \quad (i = 1, \cdots, k)
    \end{align}
\]</div>
<p>となる. 従って, 行列表現をすると</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \begin{bmatrix}
            \rho_1 \\ \rho_2 \\ \vdots \\ \rho_k
        \end{bmatrix} =
        \begin{bmatrix}
            \rho_0     &amp; \rho_1     &amp; \cdots &amp; \rho_{k-1} \\ 
            \rho_1     &amp; \rho_0     &amp; \cdots &amp; \rho_{k-2} \\ 
            \vdots     &amp; \vdots     &amp; \ddots &amp; \vdots     \\ 
            \rho_{k-1} &amp; \rho_{k-2} &amp; \cdots &amp; \rho_0
        \end{bmatrix}
        \begin{bmatrix}
            \phi_{k,1} \\ \phi_{k,2} \\ \vdots \\ \phi_{k,k}
        \end{bmatrix}
    \end{align}
\end{split}\]</div>
<p>となる.</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px;">
<p>定常時系列における<strong>偏自己相関関数</strong> (partial autocorrelation function, PACF) <span class="math notranslate nohighlight">\(\phi_{k,k}\)</span> は以下で定義される.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \begin{bmatrix}
            \phi_{k,1} \\ \phi_{k,2} \\ \vdots \\ \phi_{k,k}
        \end{bmatrix} = 
        \begin{bmatrix}
            \rho_0     &amp; \rho_1     &amp; \cdots &amp; \rho_{k-1} \\ 
            \rho_1     &amp; \rho_0     &amp; \cdots &amp; \rho_{k-2} \\ 
            \vdots     &amp; \vdots     &amp; \ddots &amp; \vdots     \\ 
            \rho_{k-1} &amp; \rho_{k-2} &amp; \cdots &amp; \rho_0
        \end{bmatrix}^{\ -1}
        \begin{bmatrix}
            \rho_1 \\ \rho_2 \\ \vdots \\ \rho_k
        \end{bmatrix}
    \end{align}
\end{split}\]</div>
</div></section>
<section id="id12">
<h3>例 3.3 (コレログラム)<a class="headerlink" href="#id12" title="Permalink to this headline">#</a></h3>
<p>今まで定義した自己相関関数, 偏自己相関関数をプロットしたグラフのことを<strong>コレログラフ</strong> (correlogram) と言い時系列データで試してみる.<br/>
　<code class="docutils literal notranslate"><span class="pre">hakusan</span></code> データは比較的定常的な時系列データだが, コレログラムにおいても大きく相関のあるラグは確認されない.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_acf.html#statsmodels.graphics.tsaplots.plot_acf" title="statsmodels.graphics.tsaplots.plot_acf"><span class="n">plot_acf</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_pacf.html#statsmodels.graphics.tsaplots.plot_pacf" title="statsmodels.graphics.tsaplots.plot_pacf"><span class="n">plot_pacf</span></a>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_acf.html#statsmodels.graphics.tsaplots.plot_acf" title="statsmodels.graphics.tsaplots.plot_acf"><span class="n">plot_acf</span></a><span class="p">(</span><span class="n">hakusan</span><span class="p">[</span><span class="s2">"YawRate"</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://www.statsmodels.org/stable/generated/statsmodels.graphics.tsaplots.plot_pacf.html#statsmodels.graphics.tsaplots.plot_pacf" title="statsmodels.graphics.tsaplots.plot_pacf"><span class="n">plot_pacf</span></a><span class="p">(</span><span class="n">hakusan</span><span class="p">[</span><span class="s2">"YawRate"</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">"ywm"</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_45_0.png" src="../../_images/ts_45_0.png"/>
</div>
</div>
<p>一方で <code class="docutils literal notranslate"><span class="pre">blsallfood</span></code> データは12ヶ月周期が波形から見えるが, 実際にラグが11の時の ACF, PACF の相関が大きいことが分かる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_acf</span><span class="p">(</span><span class="n">blsallfood</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_pacf</span><span class="p">(</span><span class="n">blsallfood</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"ywm"</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_47_0.png" src="../../_images/ts_47_0.png"/>
</div>
</div>
</section>
</section>
<section id="id13">
<h2>4. 時系列モデリングと定常性<a class="headerlink" href="#id13" title="Permalink to this headline">#</a></h2>
<p>時系列モデリングは通常は定常性を仮定してモデリングすることが中心である (モデルによっては非定常時系列データでも対応するものがあるが, モデリングのどこかに定常性を担保するための要素が入っている). ゆえにデータの前処理を行なって定常モデリングを行うことが必要.</p>
<ul class="simple">
<li><p>定常モデリング (ARモデル, ARMAモデルなど)</p>
<ol class="simple">
<li><p>データに対する前処理でできる限り定常性を持たせる</p></li>
<li><p>定常モデリングを実施する</p></li>
</ol>
</li>
<li><p>非定常モデリング</p>
<ul>
<li><p>平均が非定常</p>
<ul>
<li><p>時刻が経過するにつれてなだらかに推移する:</p>
<ul>
<li><p>ARIMA(X)</p></li>
<li><p>SARIMA(X)</p></li>
</ul>
</li>
<li><p>特定の区分に分けることで平均が定常的と見なせる:</p>
<ul>
<li><p>レベルシフトモデル</p></li>
</ul>
</li>
</ul>
</li>
<li><p>平均・分散が非定常</p>
<ul>
<li><p>特定の時間区分ごとに見ると定常的と見なせる:</p>
<ul>
<li><p>局所定常ARモデル</p></li>
</ul>
</li>
<li><p>トレンド要因, 季節要因, 誤差要因といった風に直接モデリング:</p>
<ul>
<li><p>状態空間モデル</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="id14">
<h2>5. データの前処理による定常化<a class="headerlink" href="#id14" title="Permalink to this headline">#</a></h2>
<p>与えられた時系列が定常性を持っていることの方が稀なので, 非定常な時系列データに対して変数変換を行うことで定常に近づける.</p>
<section id="id15">
<h3>例 5.1 (対数変換)<a class="headerlink" href="#id15" title="Permalink to this headline">#</a></h3>
<p>金額や人数などのデータのように値の増加に伴って変動の大きさも増大する特徴をもつ時系列に有効である. 対数変換の特徴として</p>
<ul class="simple">
<li><p>分散の一様化 (分散定常化に寄与)</p></li>
<li><p>トレンドは残るので, トレンドのある時系列に対して平均定常化を検討することは残る</p></li>
<li><p>正値時系列の無制約化 (時系列の区間変換: <span class="math notranslate nohighlight">\((0, \infty) \rightarrow (-\infty, \infty)\)</span>)</p></li>
</ul>
<p>が挙げられる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># 対数変換を行う前</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">whard</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Original"</span><span class="p">)</span>

<span class="c1"># 対数変換後</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">whard_transformed</span> <span class="o">=</span> <span class="n">whard</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">whard_transformed</span><span class="p">[</span><span class="s2">"whard"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">whard</span><span class="p">[</span><span class="s2">"whard"</span><span class="p">])</span>
<span class="n">whard_transformed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Log-transformed"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_51_0.png" src="../../_images/ts_51_0.png"/>
</div>
</div>
</section>
<section id="box-cox">
<span id="tsa-time-series-preprocess-boxcox"></span><h3>例 5.2 (Box-Cox 変換)<a class="headerlink" href="#box-cox" title="Permalink to this headline">#</a></h3>
<p><strong>Boc-Cox変換</strong> (Box-Cox transformation) は正値のデータ系列を<strong>正規分布に近づけるための変換</strong>手法で以下のように変換を行う.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        y_\lambda = \begin{cases}
            \dfrac{x^{\lambda} - 1}{\lambda} \quad &amp;(\lambda \neq 0) \\
            \log{x} \quad &amp;(\lambda \neq 0)
        \end{cases}
    \end{align}
\end{split}\]</div>
<p>従って問題になるのは, <span class="math notranslate nohighlight">\(\lambda\)</span> をどう決めるかだが, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html"> <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> </a> では対数尤度関数の値が最大となるような値を決定する.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <a class="sphinx-codeautolink-a" href="https://docs.scipy.org/doc/scipy/reference/stats.html#module-scipy.stats" title="scipy.stats"><span class="nn">scipy.stats</span></a> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html#scipy.stats.boxcox" title="scipy.stats.boxcox"><span class="n">boxcox</span></a>

<span class="n">boxcox</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html#scipy.stats.boxcox" title="scipy.stats.boxcox"><span class="n">boxcox</span></a><span class="p">(</span><span class="n">psgr</span><span class="p">[</span><span class="s2">"#Passengers"</span><span class="p">])</span>
<span class="n">psgr_boxcox</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">boxcox</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"#Passengers_Boxcox"</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">psgr</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">psgr_boxcox</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>#Passengers_Boxcox</th>
</tr>
<tr>
<th>Month</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>1949-01-01</th>
<td>6.827490</td>
</tr>
<tr>
<th>1949-02-01</th>
<td>6.932822</td>
</tr>
<tr>
<th>1949-03-01</th>
<td>7.161892</td>
</tr>
<tr>
<th>1949-04-01</th>
<td>7.114611</td>
</tr>
<tr>
<th>1949-05-01</th>
<td>6.983787</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
</tr>
<tr>
<th>1960-08-01</th>
<td>10.684049</td>
</tr>
<tr>
<th>1960-09-01</th>
<td>10.234573</td>
</tr>
<tr>
<th>1960-10-01</th>
<td>9.992159</td>
</tr>
<tr>
<th>1960-11-01</th>
<td>9.582623</td>
</tr>
<tr>
<th>1960-12-01</th>
<td>9.831860</td>
</tr>
</tbody>
</table>
<p>144 rows × 1 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">psgr_boxcox</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Box-Cox transformation (lambda = </span><span class="si">{</span><a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/functions.html#round" title="round"><span class="nb">round</span></a><span class="p">(</span><span class="n">lam</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_54_0.png" src="../../_images/ts_54_0.png"/>
</div>
</div>
</section>
<section id="tsa-time-series-preprocess-difference">
<span id="id16"></span><h3>例 5.3 (階差)<a class="headerlink" href="#tsa-time-series-preprocess-difference" title="Permalink to this headline">#</a></h3>
<p>トレンドの含まれている時系列に対しトレンド影響をなくして解析する上で<strong>階差 (差分)</strong> を取ることは非常に有効である. 例えば直線トレンドを有していたとすれば <span class="math notranslate nohighlight">\(y_n = a+bn\)</span> として</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \nabla y_n &amp;= y_n - y_{n-1} \\
                   &amp;= (a + bn) - (a + b(n-1)) \\
                   &amp;= b
    \end{align}
\end{split}\]</div>
<p>となって直線の傾き部分を打ち消すことができ, 直線トレンドの傾きの影響を取り除ける.
　また, <span class="math notranslate nohighlight">\(y = a + bn + cn^2\)</span> と 2 次曲線のトレンドを有するときに</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \nabla y_n &amp;= y_n - y_{n-1} \\
                   &amp;= (a + bn + cn^2) - (a + b(n-1) + c(n-1)^2) \\
                   &amp;= (b-c) + 2cn
    \end{align}
\end{split}\]</div>
<p>なので 2 階階差は</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{align}
        \nabla^2 y_n &amp;= \nabla y_n - \nabla y_{n-1} \\
                     &amp;= ((b-c) + 2cn) - ((b-c) + 2c(n-1)) \\
                     &amp;= 2c
    \end{align}
\end{split}\]</div>
<p>より 1 次成分, 2 次成分いずれも打ち消されることが分かる.<br/>
　<code class="docutils literal notranslate"><span class="pre">air_passengers</span></code> データにはまだ線形トレンドが見られていたので, 階差によって打ち消してみる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psgr_boxcox_diff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">psgr_boxcox</span> <span class="o">-</span> <span class="n">psgr_boxcox</span><span class="o">.</span><span class="n">shift</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">psgr</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">psgr_boxcox_diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Box-Cox and Differencing"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ts_57_0.png" src="../../_images/ts_57_0.png"/>
</div>
</div>
<p>ADF検定により実際に <span class="math notranslate nohighlight">\(I(0)\)</span> 過程であると見なすことができる.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">psgr_boxcox_diff</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="n">ret_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"adfstat"</span><span class="p">,</span> <span class="s2">"pvalue"</span><span class="p">,</span> <span class="s2">"usedlag"</span><span class="p">,</span> <span class="s2">"nobs"</span><span class="p">,</span> <span class="s2">"critvalues"</span><span class="p">,</span> <span class="s2">"icbest"</span><span class="p">]</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ret</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="https://docs.python.org/3/library/stdtypes.html#dict" title="dict"><span class="nb">dict</span></a><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ret_keys</span><span class="p">:</span>
    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">ret</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{'adfstat': -2.8717075283173945,
 'pvalue': 0.048738333926618124,
 'usedlag': 14,
 'nobs': 128,
 'critvalues': {'1%': -3.4825006939887997,
  '5%': -2.884397984161377,
  '10%': -2.578960197753906},
 'icbest': -234.74315733709795}
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./analytics/tsa"
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="../regression/blm.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">ベイズ線形回帰モデル</p>
</div>
</a>
<a class="right-next" href="arma.html" id="next-link" title="next page">
<div class="prev-next-info">
<p class="prev-next-subtitle">next</p>
<p class="prev-next-title">ARMAモデル系</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>
<div class="footer-content row">
<footer class="col footer"><p>
  
    By sndpgm<br/>
  
      © Copyright 2022.<br/>
</p>
</footer>
</div>
</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>